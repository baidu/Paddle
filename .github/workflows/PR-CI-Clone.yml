name: PR-CI-Clone

on:
  push:
    branches: [ "develop" ]
  pull_request:
    branches: [ "develop" ]

jobs:
  Clone:
    environment: Paddle-CI
    runs-on: ubuntu-latest
    steps:
    - name: Clone paddle
      uses: actions/checkout@v4
      with:
        submodules: 'recursive'

    - name: Download bos client
      env:
        WORK: "/home/runner/work/Paddle"
        AK: ${{ secrets.BOS_AK }}
        SK: ${{ secrets.BOS_SK }}
      run: |
        git checkout -b test
        tar -zcf ${WORK}/Paddle.tar.gz ${WORK}/Paddle
        python -m pip install bce-python-sdk==0.8.74
        wget -q --no-proxy -O ${WORK}/bos_upload.py  https://paddle-docker-tar.cdn.bcebos.com/bos_upload.py --no-check-certificate

    - name: Push to Bos
      env:
        WORK: "/home/runner/work/Paddle"
        PR_ID: ${{ github.event.pull_request.number }}
        COMMIT_ID: ${{ github.event.pull_request.head.sha }}
      run: |
        python3  BosClient.py Paddle.tar.gz xly-devops/PR/Paddle/${PR_ID}/${COMMIT_ID}
      working-directory: ${WORK}

    # - name: Upload Paddle artifact
    #   uses: actions/upload-artifact@v3
    #   with:
    #     name: Paddle
    #     path: Paddle.tar.gz
